Notebook[{Cell[
CellGroupData[{Cell[
BoxData[{RowBox[{"\n"," ","(*"," ","Fetch"," ","class"," ","listings"," ","for"," "," ","a"," ","paricular"," ","semester/department"," ","*)","\n","\[NonBreakingSpace]","baseurl"," ","="," ","\"https://banweb.banner.vt.edu/ssb/prod/\"",";"}],"\n","\n",RowBox[
{"\[NonBreakingSpace]","\[NonBreakingSpace]","(*"," ","avoid"," ","xxs..."," ","*)"}],"\n",RowBox[
{"\[NonBreakingSpace]","escapeScripts","[","y_","]"," ",":="," ","StringReplace","[","y",","," ","\"SCRIPT\"","\[Rule]","\"script\"","]",";"}],"\n","\n",RowBox[
{"\[NonBreakingSpace]","getTimeTable","[","sub_",","," ","sem_","]"," ",":="," ","escapeScripts","["," ","URLFetch","[","baseurl","<>","\"HZSKVTSC.P_ProcRequest/\"",",","\"Parameters\"","\[Rule]","{","\[NonBreakingSpace]","\"CAMPUS\"","\[Rule]","\"0\"",",","\[NonBreakingSpace]","\[NonBreakingSpace]","\"TERMYEAR\""," ","\[Rule]"," ","sem",",","\[NonBreakingSpace]","\[NonBreakingSpace]","\"CORE_CODE\"","\[Rule]","\"AR%\"",",","\"subj_code\"","\[Rule]","sub",",","\[NonBreakingSpace]","\"SCHDTYPE\"","\[Rule]","\"%\"",",","\[NonBreakingSpace]","\"CRSE_NUMBER\"","\[Rule]","\"\"",","," ","\"crn\"","\[Rule]","\"\"",","," ","\[NonBreakingSpace]","\"open_only\"","\[Rule]","\"\"",","," ","\"inst_name\"","\[Rule]","\"\"",",","\[NonBreakingSpace]","\"BTN_PRESSED\"","\[Rule]","\"FIND class sections\"","\[NonBreakingSpace]","}","]"," ","]",";"," "}],"\n","\n",RowBox[
{"\[NonBreakingSpace]"}],"\n",RowBox[{"\[NonBreakingSpace]","\[NonBreakingSpace]","(*"," ","Pull"," ","the"," ","links"," ","for"," ","each"," ","class"," ","*)"}],"\n",RowBox[
{"buildLink","[","csrn_",",","subj_","]"," ",":="," ","baseurl","<>","\"HZSKVTSC.P_ProcCrseText?SUBJ_IN=\"","<>","subj","<>","\"&CRSE_IN=\"","<>"," ","csrn",";"}],"\n",RowBox[
{"\[NonBreakingSpace]","getLinks","[","html_",",","subj_","]"," ",":="," ","(","buildLink","[","#",",","subj"," ","]",")","&"," ","/@","StringCases","[","html",","," ","RegularExpression","[","\"HZSKVTSC[.]P_ProcComments[?]CRN=[0-9]+(.|\\\\s)*?CRSE=([0-9]+)\"","]","\[Rule]","\"$2\"","]",";"}],"\n",RowBox[
{"\[NonBreakingSpace]"}],"\n","\n","\n",RowBox[{"(*"," ","Pulling"," ","class"," ","details"," ","and"," ","parsing"," ","the"," ","relevant"," ","info"," ","*)","\n","(*","\n","[[1]]"," ","="," ","Class"," ","prereqs"," ","CRSE"," ","list","\n"," "," "," "," ","*[[1]]"," "," ","Prereq"," ","csre","\n","\[NonBreakingSpace]","\[NonBreakingSpace]","\[NonBreakingSpace]","\[NonBreakingSpace]","*[[2]]"," ","Prereq"," ","subj","\n","[[2]]"," ","="," ","Class"," ","Name","\n","[[3]]"," ","="," ","Class"," ","Link","\n","[[4]]"," ","="," ","meh","\n","[[5]]"," ","="," ","Class"," ","CRSE","\n","[[6]]"," ","="," ","Class"," ","Subject","\n","*)","\n","matchCrse","[","x_","]"," ",":="," ","StringCases","[","x",","," ","RegularExpression","[","\"CRSE_IN=([0-9]+)\"","]","\[Rule]","\"$1\"","]",";"}],"\n",RowBox[
{"matchSubj","[","x_","]"," ",":="," ","StringCases","[","x",","," ","RegularExpression","[","\"SUBJ_IN=([A-Za-z]+)\"","]","\[Rule]","\"$1\"","]",";"}],"\n","\n",RowBox[
{"\[NonBreakingSpace]","getClassInfo1","[","x_","]"," ",":="," ","(","y","=","escapeScripts","[","URLFetch","[","x","]","]",";"," ","{","StringCases","[","y",",","RegularExpression","[","\"Prerequisites:[\\\\s]?</B></SPAN>((\\\\s|.)*?)</FONT>\"","]","\[Rule]","\"$1\"","]","[","[","1","]","]",",","\[NonBreakingSpace]","StringCases","[","y",","," ","RegularExpression","[","\"<TITLE>((\\\\s|.)*?)</TITLE>\"","]","\[Rule]","\"$1\"","]","[","[","1","]","]","}",")",";"}],"\n",RowBox[
{"\[NonBreakingSpace]","getClassInfo2","[","x_","]"," ",":="," ","(","y","=","getClassInfo1","[","x","]",";"," ","{","StringReplace","[","y","[","[","1","]","]",","," ","RegularExpression","[","\"\\\\s\"","]","\[Rule]","\"\"","]",",","y","[","[","2","]","]","}",")",";"}],"\n",RowBox[
{"\[NonBreakingSpace]","getClassInfo3","[","x_","]"," ",":="," ","(","y","=","getClassInfo2","[","x","]",";"," ","{","y","[","[","1","]","]",",","StringReplace","[","y","[","[","2","]","]",","," ","\"-\"","\[Rule]","\"\\n\"","]",","," ","x",","," ","\"meh\"",","," "," ","matchCrse","[","x","]","[","[","1","]","]","}",")",";"}],"\n",RowBox[
{"\[NonBreakingSpace]","getClassInfo4","[","x_","]"," ",":="," ","(","y","=","getClassInfo3","[","x","]",";"," ","{","y","[","[","1","]","]",",","y","[","[","2","]","]",",","y","[","[","3","]","]",",","y","[","[","4","]","]",","," ","y","[","[","5","]","]",","," "," ","matchSubj","[","x","]","[","[","1","]","]","}",")",";"}],"\n",RowBox[
{"\[NonBreakingSpace]","getClassInfo5","[","x_","]"," ",":="," ","(","y","=","getClassInfo4","[","x","]",";"," ","{","StringCases","[","y","[","[","1","]","]",","," ","RegularExpression","[","\"<A((\\\\s|.)*?)</A>\"","]","\[Rule]","\"$1\"","]",",","y","[","[","2","]","]",",","y","[","[","3","]","]",",","y","[","[","4","]","]",","," ","y","[","[","5","]","]",","," ","y","[","[","6","]","]","}",")",";"}],"\n",RowBox[
{"\[NonBreakingSpace]","getClassInfo6","[","x_","]"," ",":="," ","(","y","=","getClassInfo5","[","x","]",";"," ","{","(","{"," ","matchCrse","[","#","]","[","[","1","]","]",","," ","matchSubj","[","#","]","[","[","1","]","]"," ","}"," ","&","/@"," ","y","[","[","1","]","]",")",",","y","[","[","2","]","]",",","y","[","[","3","]","]",",","y","[","[","4","]","]",","," ","y","[","[","5","]","]",","," ","y","[","[","6","]","]","}",")",";"}],"\n",RowBox[
{"getClasses","[","sub_",","," ","sem_","]"," ",":="," ","(","getClassInfo6","[","#","]",")","&"," ","/@"," ","getLinks","["," "," ","getTimeTable","[","sub",","," ","sem","]",","," ","sub"," "," ","]",";"}],"\n","\n",RowBox[
{"(*"," ","Get"," ","a"," ","list"," ","of"," ","classes"," ","that"," ","are"," ","prereqs"," ","for"," ","the"," ","given"," ","class"," ","*)","\n","getDepends","[","x_","]",":=","(","getClassInfo5","[","#","]",")","&"," ","/@"," ","(","("," "," ","buildLink","[","#","[","[","1","]","]",","," ","#","[","[","2","]","]","]",")","&"," ","/@"," ","x","[","[","1","]","]",")",";"}],"\n","\n",RowBox[
{"(*"," ","divide"," ","into"," ","classes"," ","with"," ","and"," ","w/o"," ","prereqs"," ","*)","\n","divideClasses","[","x_","]"," ",":="," ","("," ","y","="," ","getClasses","[","x",","," ","\"201509\"","]",";","{","Select","[","y",","," "," ","Length","[","#","[","[","1","]","]","]"," ",">"," ","0"," ","&","]",","," ","Select","[","y",","," "," ","Length","[","#","[","[","1","]","]","]"," ","=="," ","0"," ","&","]","}",")",";"," "}],"\n","\n",RowBox[
{"(*"," ","Make"," ","edges"," ","between"," ","a"," ","given"," ","class"," ","and"," ","it's"," ","prereqs"," ","*)","\n","makeEdges","[","x_","]"," ",":="," ","(","("," ","x","[","[","2","]","]","\[Rule]","#","[","[","2","]","]"," ",")","&"," ","/@"," ","getDepends","[","x","]",")",";"," "}],"\n","\n",RowBox[
{"(*"," ","Get"," ","all"," ","nodes"," ","for"," ","a"," ","graph"," ","given"," ","a"," ","department"," ","code"," ","*)","\n","getNodes","[","x_","]"," ",":="," ","Flatten","[","(","cl"," ","="," ","divideClasses","[","x","]",";","{","(","makeEdges","[","#","]",")","&","/@"," "," ","DeleteDuplicates","[","cl","[","[","1","]","]","]",",","(","#","[","[","2","]","]","\[Rule]","\"None\"",")","&","/@"," "," ","DeleteDuplicates","[","cl","[","[","2","]","]","]","}",")"," ","]",";"}],"\n","\n","\n",RowBox[
{"(*"," ","Get"," ","the"," ","graph"," ","*)","\n","getClassGraph","[","depart_","]"," ",":="," ","LayeredGraphPlot","[","(","n","=","getNodes","[","depart","]",";","Print","[","Length","[","n","]","]",";"," ","n",")",","," ","DirectedEdges"," ","\[Rule]"," ","False",",","VertexLabeling"," ","\[Rule]"," ","True",","," ","ImageSize","\[Rule]","(","Print","[","Log2","[","Length","[","n","]","]"," ","*"," ","1000","]",";"," ","Log2","[","Length","[","n","]","]"," ","*"," ","1000",")","]",";"}],"\n","\n",RowBox[
{"departmentList"," ","="," ","{","\"AAEC\"",",","\"ACIS\"",",","\"AFST\"",",","\"AHRM\"",",","\"AINS\"",",","\"ALCE\"",",","\"ALS\"",",","\"AOE\"",",","\"APS\"",",","\"APSC\"",",","\"ARBC\"",",","\"ARCH\"",",","\"ART\"",",","\"AS\"",",","\"ASPT\"",",","\"AT\"",",","\"BC\"",",","\"BCHM\"",",","\"BIOL\"",",","\"BIT\"",",","\"BMES\"",",","\"BMSP\"",",","\"BMVS\"",",","\"BSE\"",",","\"BTDM\"",",","\"BUS\"",",","\"CEE\"",",","\"CHE\"",",","\"CHEM\"",",","\"CHN\"",",","\"CINE\"",",","\"CLA\"",",","\"CMDA\"",",","\"CNST\"",",","\"COMM\"",",","\"COS\"",",","\"CRIM\"",",","\"CS\"",",","\"CSES\"",",","\"DASC\"",",","\"ECE\"",",","\"ECON\"",",","\"EDCI\"",",","\"EDCO\"",",","\"EDCT\"",",","\"EDEL\"",",","\"EDEP\"",",","\"EDHE\"",",","\"EDIT\"",",","\"EDP\"",",","\"EDRE\"",",","\"EDTE\"",",","\"ENGE\"",",","\"ENGL\"",",","\"ENGR\"",",","\"ENSC\"",",","\"ENT\"",",","\"ESM\"",",","\"FA\"",",","\"FIN\"",",","\"FIW\"",",","\"FL\"",",","\"FOR\"",",","\"FR\"",",","\"FST\"",",","\"GBCB\"",",","\"GEOG\"",",","\"GEOS\"",",","\"GER\"",",","\"GIA\"",",","\"GR\"",",","\"GRAD\"",",","\"HD\"",",","\"HEB\"",",","\"HIST\"",",","\"HNFE\"",",","\"HORT\"",",","\"HTM\"",",","\"HUM\"",",","\"IDS\"",",","\"IS\"",",","\"ISC\"",",","\"ISE\"",",","\"ITAL\"",",","\"ITDS\"",",","\"JPN\"",",","\"JUD\"",",","\"LAHS\"",",","\"LAR\"",",","\"LAT\"",",","\"LDRS\"",",","\"MACR\"",",","\"MATH\"",",","\"ME\"",",","\"MGT\"",",","\"MINE\"",",","\"MKTG\"",",","\"MN\"",",","\"MS\"",",","\"MSE\"",",","\"MTRG\"",",","\"MUS\"",",","\"NANO\"",",","\"NEUR\"",",","\"NR\"",",","\"NSEG\"",",","\"PAPA\"",",","\"PHIL\"",",","\"PHS\"",",","\"PHYS\"",",","\"PORT\"",",","\"PPWS\"",",","\"PSCI\"",",","\"PSVP\"",",","\"PSYC\"",",","\"REAL\"",",","\"RLCL\"",",","\"RTM\"",",","\"RUS\"",",","\"SBIO\"",",","\"SOC\"",",","\"SPAN\"",",","\"SPIA\"",",","\"STAT\"",",","\"STL\"",",","\"STS\"",",","\"SYSB\"",",","\"TA\"",",","\"TBMH\"",",","\"UAP\"",",","\"UH\"",",","\"UNIV\"",",","\"VM\"","}",";"}],"\n","\n","\n",RowBox[
{"CloudDeploy","[","\n","FormFunction","[","\"Department\""," ","\[Rule]"," ","departmentList",","," ","getClassGraph","[","#Department","]"," ","&",",","\n","\"JPG\""," ",","," ","AppearanceRules","\[Rule]","{","\"Title\"","\[Rule]","\"Virginia Tech Class Prerequisite Tree Generator\"",","," ","\"Description\"","\[Rule]","\"Pick a department to generate a visual tree graph of the class prereqs.  Please be patient, larger departments will take a minute.\"","}","]",",","\n","\"Class Graph\"",","," ","Permissions"," ","\[Rule]"," ","\"Public\"","]","\n","\n","\n","\n"}]}],
"Input",CellID->1,CellLabel->"In[629]:= "],Cell[
BoxData[TagBox[InterpretationBox[
RowBox[{"CloudObject","[",TagBox[ButtonBox[PaneSelectorBox[{False->"\"https://www.wolframcloud.com/objects/user-f5b01625-1be5-47ac-8cd6-538aa2ec1ae2/Class Graph\"",True->StyleBox[
"\"https://www.wolframcloud.com/objects/user-f5b01625-1be5-47ac-8cd6-538aa2ec1ae2/Class Graph\"",
{"HyperlinkActive"}]},Dynamic[CurrentValue["MouseOver"]],BaseStyle->{"Hyperlink"},
FrameMargins->0,ImageSize->Automatic],BaseStyle->"Hyperlink",ButtonData->{URL["https://www.wolframcloud.com/objects/user-f5b01625-1be5-47ac-8cd6-538aa2ec1ae2/Class Graph"],None},
ButtonNote->"https://www.wolframcloud.com/objects/user-f5b01625-1be5-47ac-8cd6-538aa2ec1ae2/Class Graph"],
Function[Annotation[Slot[1],"https://www.wolframcloud.com/objects/user-f5b01625-1be5-47ac-8cd6-538aa2ec1ae2/Class Graph",
"Hyperlink"]]],"]"}],CloudObject["https://www.wolframcloud.com/objects/user-f5b01625-1be5-47ac-8cd6-538aa2ec1ae2/Class Graph"]],
"RawBoxes"],StandardForm],"Output",CellID->54,CellLabel->"Out[252]= "]},Open]],Cell[
BoxData[
RowBox[{}]],"Input",CellID->9]},StyleDefinitions->"Default.nb",FrontEndVersion->"10.0 for Wolfram Cloud Platform (June 2 2014)",
WindowSize->{1031,916}]